<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.watch.project.repository.ReviewRepository">

<resultMap type="com.watch.project.dto.MovieReviewDTO" id="review">
    <id property="id" column="id" />
	<result property="movieId" column="movie_id"/>
	<result property="userEmail" column="user_email"/>
	<result property="reviewScore" column="review_score" />
	<result property="reviewComment" column="review_comment"/>
	<result property="reviewCommentDate" column="review_comment_date"/>
</resultMap>

	<select id="getInfoByPk" resultMap="review">
		SELECT * FROM movie_review WHERE id=#{pk}
	</select>
	
	<update id="updateScore" parameterType="com.watch.project.dto.MovieReviewDTO">
		UPDATE movie_review SET review_score =#{reviewScore} WHERE id =#{id}
	</update>
	
	<insert id="insertScore" parameterType="com.watch.project.dto.MovieReviewDTO">
		INSERT INTO movie_review (id, movie_id, user_email, review_score, review_comment) VALUES(#{id}, #{movieId}, #{userEmail}, #{reviewScore}, #{reviewComment})
	</insert>
	
	<select id="getStoredScore" resultType="Float">
		SELECT review_score FROM movie_review WHERE id=#{id}
	</select>
	
	<update id="updateForComment" parameterType="com.watch.project.dto.MovieReviewDTO">
		UPDATE movie_review SET review_comment=#{reviewComment}, review_comment_date=#{reviewCommentDate} WHERE id=#{id}
	</update>
	
	<insert id="insertForComment" parameterType="com.watch.project.dto.MovieReviewDTO">
		INSERT INTO movie_review VALUES(#{id}, #{movieId}, #{userEmail}, #{reviewScore}, #{reviewComment}, #{reviewCommentDate})
	</insert>
	
	<select id="selectComments" resultMap="review">
		SELECT * FROM movie_review WHERE movie_id=#{movieId}
	</select>
	
	<select id="getComment" resultType="String">
		SELECT review_comment FROM movie_review WHERE id=#{pkId}
	</select>
</mapper>