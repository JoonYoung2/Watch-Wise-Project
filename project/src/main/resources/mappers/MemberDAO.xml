<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.watch.project.repository.MemberRepository">

<resultMap type="com.watch.project.dto.MemberDTO" id="member">
	<result property="emailToken" column="email_token" />
	<result property="userEmail" column="user_email"/>
	<result property="userPw" column="user_pw" />
	<result property="userName" column="user_name"/>
	<result property="userLoginType" column="user_login_type"/>
	<result property="socialLoginId" column="social_login_id"/>
</resultMap>

	<select id="getUserInfoByEmail" resultMap="member">
		SELECT * FROM member_info WHERE user_email=#{userEmail}
	</select>
	
	<insert id="saveMemberInfo" parameterType="com.watch.project.dto.MemberDTO">
		<selectKey keyProperty="emailToken" resultType="Integer" order="BEFORE">
			SELECT nvl(max(email_token),10000)+1
			FROM member_info
		</selectKey>
		INSERT INTO member_info 
		VALUES(#{emailToken}, #{userEmail}, #{userPw}, #{userName}, #{userLoginType}, #{socialLoginId})
	</insert>	
	
	<delete id="deleteMemberInfo" parameterType="String">
		DELETE FROM member_info WHERE user_email=#{userEmail}
	</delete>
	
	<select id="getUserInfoBySocialId" resultMap="member">
		SELECT * FROM member_info WHERE social_login_id=#{socialId}
	</select>
</mapper>